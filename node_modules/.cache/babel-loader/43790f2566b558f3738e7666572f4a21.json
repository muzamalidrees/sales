{"ast":null,"code":"import { AbilityBuilder } from \"@casl/ability\";\nvar roles;\nvar permissions;\nvar rolePermissions;\nfetch('/getAllRoles').then(function (res) {\n  return res.json();\n}).then(function (json) {\n  console.log(json);\n  roles = json.data;\n})[\"catch\"](function (err) {\n  console.log(err);\n});\nfetch('/getAllPermissions').then(function (res) {\n  return res.json();\n}).then(function (json) {\n  console.log(json);\n  permissions = json.data;\n})[\"catch\"](function (err) {\n  console.log(err);\n});\nfetch('/getAllRolesPermissions').then(function (res) {\n  return res.json();\n}).then(function (json) {\n  console.log(json);\n  rolePermissions = json.data;\n})[\"catch\"](function (err) {\n  console.log(err);\n});\nexport default function defineRulesFor(role) {\n  var _AbilityBuilder$extra = AbilityBuilder.extract(),\n      can = _AbilityBuilder$extra.can,\n      rules = _AbilityBuilder$extra.rules; //finding user's role\n\n\n  var userRoleId;\n\n  if (roles !== undefined) {\n    roles.forEach(function (Role) {\n      if (Role.name === role) {\n        userRoleId = Role.id;\n      }\n    });\n    console.log(userRoleId); //getting permissions against that role\n\n    var userRolePermissions = rolePermissions !== undefined && userRoleId !== undefined ? rolePermissions.filter(function (rolePermission) {\n      return rolePermission.role_id === userRoleId;\n    }) : undefined; //getting user's permissions\n\n    var userPermissions = [];\n\n    if (userRolePermissions !== undefined && permissions !== undefined) {\n      userRolePermissions.forEach(function (rolePermission) {\n        permissions.forEach(function (permission) {\n          if (permission.id === rolePermission.permission_id) {\n            userPermissions.push(permission);\n          }\n        });\n      });\n    }\n\n    console.log(userPermissions); // defining rules for user\n\n    if (userPermissions !== [] && userPermissions !== undefined) {\n      for (var index = 0; index < userPermissions.length; index++) {\n        can(\"\".concat(userPermissions[index].permission), \"\".concat(userPermissions[index].entity));\n        console.log(\"\".concat(userPermissions[index].permission), \"\".concat(userPermissions[index].entity));\n      }\n    }\n  }\n\n  return rules;\n}","map":{"version":3,"sources":["D:\\mzamal\\sales&stock\\sales\\src\\configs\\Ability.js"],"names":["AbilityBuilder","roles","permissions","rolePermissions","fetch","then","res","json","console","log","data","err","defineRulesFor","role","extract","can","rules","userRoleId","undefined","forEach","Role","name","id","userRolePermissions","filter","rolePermission","role_id","userPermissions","permission","permission_id","push","index","length","entity"],"mappings":"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","sourcesContent":["import { AbilityBuilder } from \"@casl/ability\";\r\n\r\nlet roles;\r\nlet permissions;\r\nlet rolePermissions;\r\nfetch('/getAllRoles')\r\n    .then((res) => res.json())\r\n    .then((json) => {\r\n        console.log(json)\r\n        roles = json.data\r\n    })\r\n    .catch((err => {\r\n        console.log(err);\r\n    }))\r\nfetch('/getAllPermissions')\r\n    .then((res) => res.json())\r\n    .then((json) => {\r\n        console.log(json)\r\n        permissions = json.data\r\n    })\r\n    .catch((err => {\r\n        console.log(err);\r\n    }))\r\n\r\nfetch('/getAllRolesPermissions')\r\n    .then((res) => res.json())\r\n    .then((json) => {\r\n        console.log(json)\r\n        rolePermissions = json.data\r\n    })\r\n    .catch((err => {\r\n        console.log(err);\r\n    }))\r\n\r\nexport default function defineRulesFor(role) {\r\n    const { can, rules } = AbilityBuilder.extract();\r\n\r\n    //finding user's role\r\n    let userRoleId;\r\n    if (roles !== undefined) {\r\n        roles.forEach(Role => {\r\n            if (Role.name === role) {\r\n                userRoleId = Role.id\r\n            }\r\n        })\r\n        console.log(userRoleId);\r\n        \r\n\r\n        //getting permissions against that role\r\n        let userRolePermissions = rolePermissions !== undefined && userRoleId !== undefined ?\r\n            rolePermissions.filter(rolePermission => rolePermission.role_id === userRoleId) : undefined\r\n\r\n        //getting user's permissions\r\n        let userPermissions = []\r\n        if (userRolePermissions !== undefined && permissions !== undefined) {\r\n            userRolePermissions.forEach(rolePermission => {\r\n                permissions.forEach(permission => {\r\n                    if (permission.id === rolePermission.permission_id) {\r\n                        userPermissions.push(permission)\r\n                    }\r\n                })\r\n            })\r\n        }\r\n        console.log(userPermissions);   \r\n\r\n        // defining rules for user\r\n        if (userPermissions !== [] && userPermissions !== undefined) {\r\n            for (let index = 0; index < userPermissions.length; index++) {\r\n                can(`${userPermissions[index].permission}`, `${userPermissions[index].entity}`)\r\n                console.log(`${userPermissions[index].permission}`, `${userPermissions[index].entity}`);\r\n                \r\n            }\r\n        }\r\n       \r\n    }\r\n    return rules;\r\n}\r\n"]},"metadata":{},"sourceType":"module"}