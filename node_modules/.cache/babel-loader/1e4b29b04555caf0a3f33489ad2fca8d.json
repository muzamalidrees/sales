{"ast":null,"code":"import { AbilityBuilder } from \"@casl/ability\";\nvar roles;\nvar permissions;\nvar rolePermissions;\nfetch('/getAllRoles').then(function (res) {\n  return res.json();\n}).then(function (json) {\n  // console.log(json)\n  roles = json.data;\n})[\"catch\"](function (err) {\n  console.log(err);\n});\nfetch('/getAllPermissions').then(function (res) {\n  return res.json();\n}).then(function (json) {\n  // console.log(json)\n  permissions = json.data;\n})[\"catch\"](function (err) {\n  console.log(err);\n});\nfetch('/getAllRolesPermissions').then(function (res) {\n  return res.json();\n}).then(function (json) {\n  // console.log(json)\n  rolePermissions = json.data;\n})[\"catch\"](function (err) {\n  console.log(err);\n});\nexport default function defineRulesFor(role) {\n  var _AbilityBuilder$extra = AbilityBuilder.extract(),\n      can = _AbilityBuilder$extra.can,\n      rules = _AbilityBuilder$extra.rules; //finding user's role\n\n\n  var userRoleId;\n\n  if (roles !== undefined) {\n    roles.forEach(function (Role) {\n      if (Role.name === role) {\n        userRoleId = Role.id;\n      }\n    }); //getting permissions against that role\n\n    var userRolePermissions = rolePermissions !== undefined && userRoleId !== undefined ? rolePermissions.filter(function (rolePermission) {\n      return rolePermission.role_id === userRoleId;\n    }) : undefined; //getting user's permissions\n\n    var userPermissions = [];\n\n    if (userRolePermissions !== undefined && permissions !== undefined) {\n      userRolePermissions.forEach(function (rolePermission) {\n        permissions.forEach(function (permission) {\n          if (permission.id === rolePermission.permission_id) {\n            userPermissions.push(permission);\n          }\n        });\n      });\n    } // console.log(userPermissions);\n    // defining rules for user\n\n\n    if (userPermissions !== [] && userPermissions !== undefined) {\n      for (var index = 0; index < userPermissions.length; index++) {\n        can(\"\".concat(userPermissions[index].permission), \"\".concat(userPermissions[index].entity));\n      }\n    } // can(\"manage\", \"all\");\n    // can(\"read\", \"all\");\n    // can(\"delete\", \"all\");\n    // can(\"update\", \"all\");\n    // can(\"create\", \"all\");\n    // switch (role) {\n    //     // case \"superAdmin\":\n    //     //     can(\"manage\", \"all\");\n    //     //     break;\n    //     case \"admin\":\n    //         can(\"manage\", \"all\");\n    //         // can(\"read\", \"all\");\n    //         // can(\"delete\", \"all\");\n    //         // can(\"update\", \"all\");\n    //         // can(\"create\", \"all\");\n    //         break;\n    //     case \"operator\":\n    //         can(\"read\", \"user\");\n    //         can('create', 'order')\n    //         can(\"read\", \"order\");\n    //         can(\"update\", \"order\");\n    //         can(\"delete\", \"order\");\n    //         break;\n    //     case \"endUser\":\n    //         can(\"read\", \"order\");\n    //         break;\n    //     default:\n    //         can(\"read\", \"order\");\n    // }\n\n  }\n\n  return rules;\n} // import { AbilityBuilder } from '@casl/ability'\n// const superAdmin = AbilityBuilder.define(can => {\n//     can('manage', 'all')\n// });\n// const admin = AbilityBuilder.define((can, cannot) => {\n//     can('read', 'all')\n//     can('delete', 'all')\n//     cannot('update', 'user')\n//     cannot('create', 'customer')\n// });\n// const operator = AbilityBuilder.define(can => {\n//     can('read', 'all')\n//     can('create', 'all')\n// });\n// const endUser = AbilityBuilder.define(can => {\n//     can('read', 'all')\n// });\n// const ABILITIES = { superAdmin, admin, operator, endUser }\n// export default ABILITIES","map":{"version":3,"sources":["d:\\mzamal\\sales&stock\\sales\\src\\configs\\Ability.js"],"names":["AbilityBuilder","roles","permissions","rolePermissions","fetch","then","res","json","data","err","console","log","defineRulesFor","role","extract","can","rules","userRoleId","undefined","forEach","Role","name","id","userRolePermissions","filter","rolePermission","role_id","userPermissions","permission","permission_id","push","index","length","entity"],"mappings":"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","sourcesContent":["import { AbilityBuilder } from \"@casl/ability\";\r\n\r\nlet roles;\r\nlet permissions;\r\nlet rolePermissions;\r\nfetch('/getAllRoles')\r\n    .then((res) => res.json())\r\n    .then((json) => {\r\n        // console.log(json)\r\n        roles = json.data\r\n    })\r\n    .catch((err => {\r\n        console.log(err);\r\n    }))\r\nfetch('/getAllPermissions')\r\n    .then((res) => res.json())\r\n    .then((json) => {\r\n        // console.log(json)\r\n        permissions = json.data\r\n    })\r\n    .catch((err => {\r\n        console.log(err);\r\n    }))\r\n\r\nfetch('/getAllRolesPermissions')\r\n    .then((res) => res.json())\r\n    .then((json) => {\r\n        // console.log(json)\r\n        rolePermissions = json.data\r\n    })\r\n    .catch((err => {\r\n        console.log(err);\r\n    }))\r\n\r\nexport default function defineRulesFor(role) {\r\n    const { can, rules } = AbilityBuilder.extract();\r\n\r\n    //finding user's role\r\n    let userRoleId;\r\n    if (roles !== undefined) {\r\n        roles.forEach(Role => {\r\n            if (Role.name === role) {\r\n                userRoleId = Role.id\r\n            }\r\n        })\r\n\r\n        //getting permissions against that role\r\n        let userRolePermissions = rolePermissions !== undefined && userRoleId !== undefined ?\r\n            rolePermissions.filter(rolePermission => rolePermission.role_id === userRoleId) : undefined\r\n\r\n        //getting user's permissions\r\n        let userPermissions = []\r\n        if (userRolePermissions !== undefined && permissions !== undefined) {\r\n            userRolePermissions.forEach(rolePermission => {\r\n                permissions.forEach(permission => {\r\n                    if (permission.id === rolePermission.permission_id) {\r\n                        userPermissions.push(permission)\r\n                    }\r\n                })\r\n            })\r\n        }\r\n        // console.log(userPermissions);\r\n\r\n        // defining rules for user\r\n        if (userPermissions !== [] && userPermissions !== undefined) {\r\n            for (let index = 0; index < userPermissions.length; index++) {\r\n                can(`${userPermissions[index].permission}`, `${userPermissions[index].entity}`)\r\n            }\r\n        }\r\n        // can(\"manage\", \"all\");\r\n        // can(\"read\", \"all\");\r\n        // can(\"delete\", \"all\");\r\n        // can(\"update\", \"all\");\r\n        // can(\"create\", \"all\");\r\n\r\n        // switch (role) {\r\n        //     // case \"superAdmin\":\r\n        //     //     can(\"manage\", \"all\");\r\n        //     //     break;\r\n        //     case \"admin\":\r\n\r\n        //         can(\"manage\", \"all\");\r\n        //         // can(\"read\", \"all\");\r\n        //         // can(\"delete\", \"all\");\r\n        //         // can(\"update\", \"all\");\r\n        //         // can(\"create\", \"all\");\r\n        //         break;\r\n        //     case \"operator\":\r\n        //         can(\"read\", \"user\");\r\n        //         can('create', 'order')\r\n        //         can(\"read\", \"order\");\r\n        //         can(\"update\", \"order\");\r\n        //         can(\"delete\", \"order\");\r\n        //         break;\r\n        //     case \"endUser\":\r\n        //         can(\"read\", \"order\");\r\n        //         break;\r\n        //     default:\r\n        //         can(\"read\", \"order\");\r\n        // }\r\n    }\r\n    return rules;\r\n}\r\n\r\n        // import { AbilityBuilder } from '@casl/ability'\r\n\r\n        // const superAdmin = AbilityBuilder.define(can => {\r\n            //     can('manage', 'all')\r\n            // });\r\n\r\n// const admin = AbilityBuilder.define((can, cannot) => {\r\n//     can('read', 'all')\r\n//     can('delete', 'all')\r\n//     cannot('update', 'user')\r\n//     cannot('create', 'customer')\r\n// });\r\n// const operator = AbilityBuilder.define(can => {\r\n//     can('read', 'all')\r\n//     can('create', 'all')\r\n\r\n// });\r\n\r\n// const endUser = AbilityBuilder.define(can => {\r\n//     can('read', 'all')\r\n// });\r\n// const ABILITIES = { superAdmin, admin, operator, endUser }\r\n// export default ABILITIES"]},"metadata":{},"sourceType":"module"}