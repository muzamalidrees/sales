{"ast":null,"code":"import { AbilityBuilder } from \"@casl/ability\";\nvar roles;\nvar permissions;\nvar rolePermissions;\nfetch('/getAllRoles').then(function (res) {\n  return res.json();\n}).then(function (json) {\n  // console.log(json)\n  roles = json.data;\n})[\"catch\"](function (err) {\n  console.log(err);\n});\nfetch('/getAllPermissions').then(function (res) {\n  return res.json();\n}).then(function (json) {\n  // console.log(json)\n  permissions = json.data;\n})[\"catch\"](function (err) {\n  console.log(err);\n  console.error(err.toString());\n  console.warn(xhr.responseText);\n});\nfetch('/getAllRolesPermissions').then(function (res) {\n  return res.json();\n}).then(function (json) {\n  // console.log(json)\n  rolePermissions = json.data;\n})[\"catch\"](function (err) {\n  console.log(err);\n});\nexport default function defineRulesFor(role) {\n  var _AbilityBuilder$extra = AbilityBuilder.extract(),\n      can = _AbilityBuilder$extra.can,\n      rules = _AbilityBuilder$extra.rules; //finding user's role\n\n\n  var userRoleId;\n\n  if (roles !== undefined) {\n    roles.forEach(function (Role) {\n      if (Role.name === role) {\n        userRoleId = Role.id;\n      }\n    }); //getting permissions against that role\n\n    var userRolePermissions = rolePermissions !== undefined && userRoleId !== undefined ? rolePermissions.filter(function (rolePermission) {\n      return rolePermission.role_id === userRoleId;\n    }) : undefined; //getting user's permissions\n\n    var userPermissions = [];\n\n    if (userRolePermissions !== undefined && permissions !== undefined) {\n      userRolePermissions.forEach(function (rolePermission) {\n        permissions.forEach(function (permission) {\n          if (permission.id === rolePermission.permission_id) {\n            userPermissions.push(permission);\n          }\n        });\n      });\n    } // console.log(userPermissions);\n    // defining rules for user\n\n\n    if (userPermissions !== [] && userPermissions !== undefined) {\n      for (var index = 0; index < userPermissions.length; index++) {\n        can(\"\".concat(userPermissions[index].permission), \"\".concat(userPermissions[index].entity));\n      }\n    }\n  }\n\n  return rules;\n}","map":{"version":3,"sources":["d:\\mzamal\\sales&stock\\sales\\src\\configs\\Ability.js"],"names":["AbilityBuilder","roles","permissions","rolePermissions","fetch","then","res","json","data","err","console","log","error","toString","warn","xhr","responseText","defineRulesFor","role","extract","can","rules","userRoleId","undefined","forEach","Role","name","id","userRolePermissions","filter","rolePermission","role_id","userPermissions","permission","permission_id","push","index","length","entity"],"mappings":"AAAA,SAASA,cAAT,QAA+B,eAA/B;AAEA,IAAIC,KAAJ;AACA,IAAIC,WAAJ;AACA,IAAIC,eAAJ;AACAC,KAAK,CAAC,cAAD,CAAL,CACKC,IADL,CACU,UAACC,GAAD;AAAA,SAASA,GAAG,CAACC,IAAJ,EAAT;AAAA,CADV,EAEKF,IAFL,CAEU,UAACE,IAAD,EAAU;AACZ;AACAN,EAAAA,KAAK,GAAGM,IAAI,CAACC,IAAb;AACH,CALL,WAMY,UAAAC,GAAG,EAAI;AACXC,EAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;AACH,CARL;AASAL,KAAK,CAAC,oBAAD,CAAL,CACKC,IADL,CACU,UAACC,GAAD;AAAA,SAASA,GAAG,CAACC,IAAJ,EAAT;AAAA,CADV,EAEKF,IAFL,CAEU,UAACE,IAAD,EAAU;AACZ;AACAL,EAAAA,WAAW,GAAGK,IAAI,CAACC,IAAnB;AACH,CALL,WAMY,UAAAC,GAAG,EAAI;AACXC,EAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;AACAC,EAAAA,OAAO,CAACE,KAAR,CAAeH,GAAG,CAACI,QAAJ,EAAf;AACAH,EAAAA,OAAO,CAACI,IAAR,CAAaC,GAAG,CAACC,YAAjB;AACH,CAVL;AAYAZ,KAAK,CAAC,yBAAD,CAAL,CACKC,IADL,CACU,UAACC,GAAD;AAAA,SAASA,GAAG,CAACC,IAAJ,EAAT;AAAA,CADV,EAEKF,IAFL,CAEU,UAACE,IAAD,EAAU;AACZ;AACAJ,EAAAA,eAAe,GAAGI,IAAI,CAACC,IAAvB;AACH,CALL,WAMY,UAAAC,GAAG,EAAI;AACXC,EAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;AACH,CARL;AAUA,eAAe,SAASQ,cAAT,CAAwBC,IAAxB,EAA8B;AAAA,8BAClBlB,cAAc,CAACmB,OAAf,EADkB;AAAA,MACjCC,GADiC,yBACjCA,GADiC;AAAA,MAC5BC,KAD4B,yBAC5BA,KAD4B,EAGzC;;;AACA,MAAIC,UAAJ;;AACA,MAAIrB,KAAK,KAAKsB,SAAd,EAAyB;AACrBtB,IAAAA,KAAK,CAACuB,OAAN,CAAc,UAAAC,IAAI,EAAI;AAClB,UAAIA,IAAI,CAACC,IAAL,KAAcR,IAAlB,EAAwB;AACpBI,QAAAA,UAAU,GAAGG,IAAI,CAACE,EAAlB;AACH;AACJ,KAJD,EADqB,CAOrB;;AACA,QAAIC,mBAAmB,GAAGzB,eAAe,KAAKoB,SAApB,IAAiCD,UAAU,KAAKC,SAAhD,GACtBpB,eAAe,CAAC0B,MAAhB,CAAuB,UAAAC,cAAc;AAAA,aAAIA,cAAc,CAACC,OAAf,KAA2BT,UAA/B;AAAA,KAArC,CADsB,GAC4DC,SADtF,CARqB,CAWrB;;AACA,QAAIS,eAAe,GAAG,EAAtB;;AACA,QAAIJ,mBAAmB,KAAKL,SAAxB,IAAqCrB,WAAW,KAAKqB,SAAzD,EAAoE;AAChEK,MAAAA,mBAAmB,CAACJ,OAApB,CAA4B,UAAAM,cAAc,EAAI;AAC1C5B,QAAAA,WAAW,CAACsB,OAAZ,CAAoB,UAAAS,UAAU,EAAI;AAC9B,cAAIA,UAAU,CAACN,EAAX,KAAkBG,cAAc,CAACI,aAArC,EAAoD;AAChDF,YAAAA,eAAe,CAACG,IAAhB,CAAqBF,UAArB;AACH;AACJ,SAJD;AAKH,OAND;AAOH,KArBoB,CAsBrB;AAEA;;;AACA,QAAID,eAAe,KAAK,EAApB,IAA0BA,eAAe,KAAKT,SAAlD,EAA6D;AACzD,WAAK,IAAIa,KAAK,GAAG,CAAjB,EAAoBA,KAAK,GAAGJ,eAAe,CAACK,MAA5C,EAAoDD,KAAK,EAAzD,EAA6D;AACzDhB,QAAAA,GAAG,WAAIY,eAAe,CAACI,KAAD,CAAf,CAAuBH,UAA3B,aAA4CD,eAAe,CAACI,KAAD,CAAf,CAAuBE,MAAnE,EAAH;AACH;AACJ;AAEJ;;AACD,SAAOjB,KAAP;AACH","sourcesContent":["import { AbilityBuilder } from \"@casl/ability\";\r\n\r\nlet roles;\r\nlet permissions;\r\nlet rolePermissions;\r\nfetch('/getAllRoles')\r\n    .then((res) => res.json())\r\n    .then((json) => {\r\n        // console.log(json)\r\n        roles = json.data\r\n    })\r\n    .catch((err => {\r\n        console.log(err);\r\n    }))\r\nfetch('/getAllPermissions')\r\n    .then((res) => res.json())\r\n    .then((json) => {\r\n        // console.log(json)\r\n        permissions = json.data\r\n    })\r\n    .catch((err => {\r\n        console.log(err);\r\n        console.error( err.toString())\r\n        console.warn(xhr.responseText)\r\n    }))\r\n\r\nfetch('/getAllRolesPermissions')\r\n    .then((res) => res.json())\r\n    .then((json) => {\r\n        // console.log(json)\r\n        rolePermissions = json.data\r\n    })\r\n    .catch((err => {\r\n        console.log(err);\r\n    }))\r\n\r\nexport default function defineRulesFor(role) {\r\n    const { can, rules } = AbilityBuilder.extract();\r\n\r\n    //finding user's role\r\n    let userRoleId;\r\n    if (roles !== undefined) {\r\n        roles.forEach(Role => {\r\n            if (Role.name === role) {\r\n                userRoleId = Role.id\r\n            }\r\n        })\r\n\r\n        //getting permissions against that role\r\n        let userRolePermissions = rolePermissions !== undefined && userRoleId !== undefined ?\r\n            rolePermissions.filter(rolePermission => rolePermission.role_id === userRoleId) : undefined\r\n\r\n        //getting user's permissions\r\n        let userPermissions = []\r\n        if (userRolePermissions !== undefined && permissions !== undefined) {\r\n            userRolePermissions.forEach(rolePermission => {\r\n                permissions.forEach(permission => {\r\n                    if (permission.id === rolePermission.permission_id) {\r\n                        userPermissions.push(permission)\r\n                    }\r\n                })\r\n            })\r\n        }\r\n        // console.log(userPermissions);\r\n\r\n        // defining rules for user\r\n        if (userPermissions !== [] && userPermissions !== undefined) {\r\n            for (let index = 0; index < userPermissions.length; index++) {\r\n                can(`${userPermissions[index].permission}`, `${userPermissions[index].entity}`)\r\n            }\r\n        }\r\n       \r\n    }\r\n    return rules;\r\n}\r\n"]},"metadata":{},"sourceType":"module"}